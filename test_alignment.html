<!DOCTYPE html>
<html>
<head>
    <title>Web Mercator Alignment Test</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        #map { height: 100vh; width: 100%; }
        .info-box {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 10px;
            z-index: 1000;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="info-box">
        <strong>Natural Earth Coastlines</strong><br>
        Using 50m resolution coastline data<br>
        <br>
        Climate data should align with markers:<br>
        - London (51°N, 0°) - land data<br>
        - NYC (40.7°N, -74°W) - land data<br>
        - Reykjavik (64°N) - land data<br>
        - Sahara (25°N, 0°) - land data<br>
        - Atlantic (30°N, -40°W) - dark ocean<br>
        <br>
        <strong>Settings:</strong> σ=0, lanczos
    </div>
    <script>
        var map = L.map('map').setView([51, 0], 4);

        // Dark basemap
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; CARTO'
        }).addTo(map);

        // Web Mercator bounds: -85.051 to 85.051 latitude
        var bounds = [[-85.051, -180], [85.051, 180]];
        var url = 'http://localhost:8002/simple/era5_land/2m_temperature/0/RdYlBu_r.png?sigma=0&interp=lanczos&t=' + Date.now();

        L.imageOverlay(url, bounds, {opacity: 0.9}).addTo(map);

        // Test markers at known locations
        var markers = [
            {lat: 51.5, lon: 0, name: 'London', color: 'red'},
            {lat: 40.7, lon: -74, name: 'NYC', color: 'blue'},
            {lat: 64.1, lon: -21.9, name: 'Reykjavik', color: 'green'},
            {lat: 25, lon: 0, name: 'Sahara Desert', color: 'orange'},
            {lat: 30, lon: -40, name: 'Atlantic Ocean', color: 'purple'},
            {lat: 0, lon: 0, name: 'Equator/Prime Meridian', color: 'white'}
        ];

        markers.forEach(function(m) {
            var icon = L.divIcon({
                className: 'marker-icon',
                html: '<div style="background:' + m.color + ';width:12px;height:12px;border-radius:50%;border:2px solid white;"></div>',
                iconSize: [16, 16],
                iconAnchor: [8, 8]
            });
            L.marker([m.lat, m.lon], {icon: icon})
                .addTo(map)
                .bindPopup(m.name + '<br>(' + m.lat + '°N, ' + m.lon + '°E)');
        });
    </script>
</body>
</html>
